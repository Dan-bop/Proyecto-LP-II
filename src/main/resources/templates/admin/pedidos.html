<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Listado de Pedidos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

<h3 class="mb-4 text-center">Gestión de Pedidos</h3>

<div class="d-flex justify-content-between mb-3">
    <a th:href="@{/admin}" class="btn btn-secondary">⬅ Volver al Panel</a>
    </div>
	<form th:action="@{/admin/pedidos}" method="get" class="d-flex justify-content-end mb-3">
	    <select name="estado" class="form-select me-2" style="width: 200px;">
	        <option value="">-- Todos los estados --</option>
	        <option value="Pendiente" th:selected="${estadoActual == 'Pendiente'}">Pendiente</option>
	        <option value="Enviado" th:selected="${estadoActual == 'Enviado'}">Enviado</option>
	        <option value="Entregado" th:selected="${estadoActual == 'Entregado'}">Entregado</option>
	    </select>
	    <button type="submit" class="btn btn-primary">Filtrar</button>
	    <a th:href="@{/admin/pedidos}" class="btn btn-secondary ms-2">Limpiar</a>
	</form>
	<table class="table table-striped">
    <thead>
        <tr>
            <th>ID Pedido</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Total</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="pedido : ${pedidos}">
            
            <td th:text="${pedido.id}"></td>
            
			<td th:text="${pedido.usuario != null} ? ${pedido.usuario.nombre + ' ' + pedido.usuario.apellido} : 'Usuario Eliminado'">
			</td>
            
            <td th:text="${#temporals.format(pedido.fecha, 'dd/MM/yyyy')}"></td>
            
            <td>
                 <span th:text="${pedido.estado}"
                       th:classappend="${pedido.estado == 'Pendiente'} ? 'badge bg-warning' : 
                                      (${pedido.estado == 'Enviado'} ? 'badge bg-info' : 
                                      'badge bg-success')">
                 </span>
            </td>
            
            <td th:text="${'S/ ' + #numbers.formatDecimal(pedido.total, 1, 'COMMA', 2, 'POINT')}"></td>
            
            <td>
				<a th:href="@{/admin/pedidos/detalle/{id}(id=${pedido.id})}" class="btn btn-info btn-sm">
				    Ver Detalles
				</a>
            </td>
        </tr>
        
        <tr th:if="${#lists.isEmpty(pedidos)}">
            <td colspan="6" class="text-center text-muted">No se encontraron pedidos.</td>
        </tr>
    </tbody>
</table>

</body>
</html>